name: Ambros CI Build Dev

on:
  workflow_dispatch:
  push:
    branches:
      - main

concurrency: 
  group: ios-build-dev
  cancel-in-progress: true

env:
  LANG: en_US.UTF-8
  
jobs:
  clone-and-build:
    runs-on: macos-12
    environment: main
    env:
      AMBROS_MOBILE_SSH_PRIVATE_KEY: ${{ secrets.AMBROS_MOBILE_SSH_PRIVATE_KEY }}
      AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY: ${{ secrets.AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Get configuration items
        run: |
          echo $AMBROS_MOBILE_SSH_PRIVATE_KEY | base64 --decode > AMBROS_MOBILE_SSH_PRIVATE_KEY.key
          chmod 600 AMBROS_MOBILE_SSH_PRIVATE_KEY.key
          head -1 AMBROS_MOBILE_SSH_PRIVATE_KEY.key

          echo $AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY | base64 --decode > AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY.key
          chmod 600 AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY.key


          ls -al
          rm -rf $HOME/ambros_mobile

          GIT_SSH_COMMAND='ssh -i AMBROS_MOBILE_SSH_PRIVATE_KEY.key -o IdentitiesOnly=yes -o StrictHostKeyChecking=no' git clone git@github.com:Ambros-Technology/ambros_mobile.git $HOME/ambros_mobile

          
          rm -rf $HOME/ambros_mobiles_keys

          GIT_SSH_COMMAND='ssh -i AMBROS_MOBILES_KEYS_SSH_PRIVATE_KEY.key -o IdentitiesOnly=yes -o StrictHostKeyChecking=no' git clone git@github.com:Ambros-Technology/ambros_mobiles_keys.git $HOME/ambros_mobiles_keys
          
